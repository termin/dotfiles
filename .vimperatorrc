" for Mac

" -----Notice -----
" set!はFirefoxの設定を変える
" setはvimperatorの設定
" らしい.

" Loading
echo "vimp: We'll back soon..."

" ----- Main options -----
set runtimepath=/Users/termin/.vimperator
source! /Users/termin/.vimperatorrc.local

set guioptions=rb

" ブラウザタイトルの変更
" set titlestring=vimp
" ページ全体で検索語を強調表示
set hlsearch
" 検索語の大文字小文字を無視
" set ignorecase

"ビープ音を鳴らさずビジュアルベルを使用
set visualbell
"ビジュアルベルを無効化
hi Bell display: none;

" 新しいタブで開く
set newtab=all
" exモード時でインクリメント補完
set wildoptions=auto
" input要素にfocusを奪われないようにする
" AwesomeBarを使いたい場合に、フォーカスがvimpに取られてしまうと扱いにくい
set focuscontent

" Items which are completed at the :open prompts. Available items:
" default: slf
" s Search engines and keyword URLs 
" f Local files 
" l Firefox location bar entries (bookmarks and history sorted in an intelligent way) 
" b Bookmarks 
" h History 
" S Search engine suggestions 
" t Open tabs
set complete=slS
" リンク先の表示位置
set showstatuslinks=2
"Awesomebarの補完対象にBookmarkletを追加、件数を50件に変更
" set! browser.urlbar.filter.javascript=false
" set! browser.urlbar.maxRichResults=50 

set showtabline=1

" ----- Key Mappings -----
" 今は適当に割り当てているだけだけど, その内出来るところは整理したい.

" show current website with a minimal style sheet.
noremap ! :set usermode<CR>

" <M-A-Left>/<M-A-Right>かh/lでタブ移動
map <M-A-Left> <C-p>
map <M-A-Right> <C-n>
nmap h <C-p>
nmap l <C-n>
"<S-M-Left>/<S-M-Right>で現在のタブの位置変更
map <S-M-Left>  :tabmove! -1<CR>:echo "うごうご・・・！"<CR>
map <S-M-Right> :tabmove! +1<CR>:echo "うごうご・・・！"<CR>
" <M-f>でvimpによる検索/
map <M-f> /
nmap e gi
" URL中の数字を++/--
noremap ++ <C-a>
noremap -- <C-x>
" d キーでも直前にフォーカスしていたタブに戻る様にする
noremap <C-w> <M-w>
map d <C-w>
" undo一覧から開く
map U :undo<Space>
map ,s :saves<CR>
" .vimperatorrcをリロード.
" mapcだけじゃ全てのmappingがクリアされないみたい. 追試済み (http://d.hatena.ne.jp/blooo/20100120/1263963525)
" nnoremap <silent> ,r :mapc<CR>:cmapc<CR>:imapc<CR>:so ~/.vimperatorrc<CR>
nnoremap ,r :mapc<CR>:cmapc<CR>:imapc<CR>:so ~/.vimperatorrc<CR>

" colorscheme (http://coderepos.org/share/browser/lang/javascript/vimperator-plugins/trunk/colors/)
" colorscheme sweets_snaka
" colorscheme sweets
" colorscheme default
" colorscheme simple
colorscheme vimplight

" ----- Plugin Options  -----
" (http://coderepos.org/share/browser/dotfiles/vimperator/retlet-vimperatorrc?rev=)
" trunk以外にbranches/2.xからも欲しい時はどう指定すれば良いのだろう
" let g:plugin_loader_roots = "~/.vimperator/plugin-test/"
" let g:plugin_loader_plugins = "_libly,bitly,char-hints-mod2,copy,exopen,feedSomeKeys_2,imageextender,ldrize_cooperation,localkeymode,migratestatusbar,multi_requester,no-reading,pluginManager,removetabs,sl,stella,tabsort,toggler,walk-input,yetmappings"

"<C-Del>で検索語の強調表示をトグル(toggleHighlight.js)
"map <C-Del> :toggleHighlight<CR>
"<A-g>でGreasemonkeyをトグル(gmperator.js)
"map <A-g> :gmset!<CR>

" google-translator.js
nmap ,gt :gtrans<Space>

" nextlink.js
" let g:nextlink_followlink = "true"
" let g:nextlink_nositeinfo_act = "f"
" f Vimperatorの"[[", "]]"の動作
" e マッチするSITEINFOが無いことを知らせる(デフォルト設定)
" n 何もしない
let g:nextlink_prevmap = "K"
let g:nextlink_nextmap = "J"

" twittperator.js
" ChirpUserStreamを使う
let g:twittperator_use_chirp = 1
" コマンドラインにtweetを自動的に表示
let g:twittperator_plugin_echo_tweet = 0
" reply_popup_alert
let g:twittperator_plugin_reply_popup_alert = 1
let g:twittperator_plugin_reply_popup_alert_username = "termin"

" google-search.js
" 遅い.イマイチ使えない.
nmap <S-C-g> :gsearch!<Space>

" copy.js
" <M-S-c>でタイトルとURLをコピー
map <M-S-c> :copy titleAndURL<CR>
js <<EOM
liberator.globalVariables.copy_templates = [
  { label: 'titleAndURL',    value: '%TITLE%\n%URL%' },
  { label: 'title',          value: '%TITLE%', map: ',y' },
  { label: 'anchor',         value: '<a href="%URL%">%TITLE%</a>' },
  { label: 'selanchor',      value: '<a href="%URL%" title="%TITLE%">%SEL%</a>' },
  { label: 'htmlblockquote', value: '<blockquote cite="%URL%" title="%TITLE%">%HTMLSEL%</blockquote>' },
  { label: 'hatena',		 value: '[%URL%:title]'},
  { label: 'hatenawithtitle',value: '%URL%:title=%TITLE%'},
  { label: 'ASIN',   value: 'copy ASIN code from Amazon', custom: function(){return content.document.getElementById('ASIN').value;} }
];
EOM

" localkeymode.js, stella.js
" stseek! +10がうまく動かないなぁ. -10なら動くんだけど.
let g:localkeymode_enable = "true"
js <<EOM
liberator.globalVariables.localKeyMappings=[
  [/^http:\/\/www\.(nicovideo\.jp|youtube\.com)\/watch/, [
    ['p', ':stplay'],
    ['m', ':stmute'],
    ['v', ':stcomment'],
    ['s', ':stseek! +10'],
    ['S', ':stseek! -10'],
    ['z', ':stlarge'],
  ]],
];
EOM

" feedSomekeys_3.js
command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
" Gmail
lazy fmaps -u='^https?://mail\.google\.com/(mail|a)/' c / j k n p o u e x s r a # [ ] z ? gi gs gt gd ga gc gb
" Livedoor Reader
lazy fmaps -u='^http://(reader\.livedoor|fastladder)\.com/reader/' j k o s a p v c z r < > <Space> <S-Space> q w e g
" RememberTheMilk
lazy fmaps -u='^https?://www\.rememberthemilk\.com/home/' j k m i n a x c t r d s ? d F,f G,g L,l Y,y H,h M,m z <Del> 0 1 2 3 4
" Tumblr (use : ReblogCommand, TumblrTagCommand)
lazy fmaps -u='^http://[^\./]*\.tumblr\.com/' i,t e,tk n,h
"fmap -urls='^http://[^\./]*\.tumblr\.com/' g g
" はてなブックマーク
lazy fmaps -u='^http://b\.hatena\.ne\.jp/(?!(entry|articles|guide))' j k o
" Google Calendar
lazy fmap -u='^http://www\.google\.com/calendar/' -event=keydown j k t a d w m x c e <Del> / + q s ?

" removetabs.js
" 左側にあるタブを閉じる
noremap <C-S-Left> :removetabsleft
" 右側にあるタブを閉じる
noremap <C-S-Right> :removetabsright
" tabsort.js
command! urlsort tabsort -t=url
" _smooziee.js
" let g:smooziee_scroll_amount="10"
" let g:smooziee_scroll_interval="50"

" char-hints-mod2.js
" let g:hintchars="asdfjkl"
let g:hintsio="iO"
" let g:hintlabeling=""

" multi_requester.js
map ,mf :mr<Space>favotter-new<Space>termin<CR>

" toggler.js
" js <<EOM
" liberator.globalVariables.toggler = {
"   //  name: [ setting commands ]],
"   // ツールバー
"   go: ["set go=rbT","set go=rb"],
"   // タブバー
"   tab:["set showtabline=0", "set showtabline=2"],
"   // サイドバー
"   sb: ["sbclose","sbar Console"],
"   go_and_sb: [
"     ["set go=","sbclose"],
"     ["set go=mTb","sbar Console"]
"   ],
" };
" EOM

" map <F2> :toggle go<CR>
map ,1 :set go=rbT<CR>
map ,2 :set go=rb<CR>
" map ,q :set showtabline="2"<CR>
" map ,w :set showtabline="0"<CR>
" travian のみでツールバーを表示する
" autocmd LocationChange .* set go=rb
" autocmd LocationChange ^http://s4.travian.jp/ set go=rbT

" はてなブックマーク拡張( http://subtech.g.hatena.ne.jp/secondlife/20090402/1238655382 )
javascript if (typeof hBookmark != 'undefined') liberator.loadScript('chrome://hatenabookmark/content/vimperator/plugin/hatenabookmark.js', {__proto__: this});

javascript <<EOF
// キーボードショートカットの指定
// 空(null)を指定すれば hints や nnoremap を上書きしなくなる
liberator.globalVariables.hBookmark_shortcuts = {
    hintsAdd     : 'c',
    hintsComment : 'C',
    add          : ['<S-C-v>'],
    comment      : ['<S-c>'],
};
// コマンドの設定
// 検索時の wait(ms)
// liberator.globalVariables.hBookmark_search_interval = 1000;
// 一度に検索する limit
// liberator.globalVariables.hBookmark_search_limit = 10;
// 検索時の表示の最大件数. この件数に達するまで検索し続ける.
// liberator.globalVariables.hBookmark_search_max_limit = 100;
EOF

" entry_pageを表示する( exopen.js )
javascript <<EOM
liberator.globalVariables.exopen_templates = [
{
  label: 'hatenaep',
  value: 'http://b.hatena.ne.jp/entry/%URL%',
  description: 'open hatena bookmark entrypage',
  newtab: true
}];
EOM
noremap <S-x> :exopen hatenaep<CR>

" direct_bookmark.js
let g:direct_sbm_use_services_by_tag="h"
let g:direct_sbm_use_services_by_post="h"
let g:direct_sbm_echo_type="multiline"
" let g:direct_sbm_is_normalize
" let g:direct_sbm_is_use_migemo

noremap <S-v> :sbm<CR>

" autocmd VimperatorEnter .* :set complete+=H
" はてブ検索(はてなブックマーク拡張)
noremap c :hbt<Space>
" noremap cx :
" コメントのみ対象
noremap <C-c> :hbtc<Space>
" titleのみ対象
noremap <C-t> :hbtti<Space>
" urlのみ対象
noremap <C-u> :hbtu<Space>

" ldrize_cooperation.js
let g:ldrc_captureMappings = "['j','k','p','o','?']"

" autopagerize_control.js
" let g:autopagerize_prevmap = "K" 
" let g:autopagerize_nextmap = "J"

" no-reading.js
let g:no_reading_do_echo = 1

" migrate_statusbar.js 
" ☆, feed, faviconをステータスラインに移動 
javascript <<EOM
liberator.globalVariables.migrate_elements = [
  {
      // star button of awesome bar
      id:    'star-button',
      dest:  'security-button',
      after: true,
  },
  {
      // icon that show the existence of RSS and Atom on current page
      id:    'feed-button',
      dest:  'security-button',
      after: true,
  },
  {
      // favicon of awesome bar
      id:    'page-proxy-stack',
      dest:  'liberator-statusline',
      after: false,
  },
];
EOM

" lo.js
noremap <S-C-f> :fo<Space>
noremap <S-C-l> :lo<Space>

" zip-de-download
let g:zipDownloadDir = "~/Desktop"
noremap <S-C-z> :zipdownload -auto-detect jpg

" ----- Others -----
" yourfilehost cookie削除
" cf.http://anond.hatelabo.jp/20100108213648
js <<EOM
commands.addUserCommand(
  ['removeCookieOfYourfile'],
  'removeCookieOfYourfile',
  function() {
    liberator.execute('cookiemanager remove yourfilehostdatabase.com/');
    liberator.execute('cookiemanager remove yourfilehost.com/');
    liberator.execute('cookiemanager remove yourlifehost.jp/');
        }
);
EOM

" フィードボタンをステータスラインに移動
" javascript <<EOM
" (function () {
"     var feedButton = document.getElementById('feed-button');
"         feedButton.parentNode.removeChild(feedButton);
"     var feedPanel  = document.createElement('statusbarpanel');
"         feedPanel.setAttribute('id', 'feed-panel-clone');
"         feedPanel.appendChild(feedButton.cloneNode(true));
"     document.getElementById('status-bar').insertBefore(
"         feedPanel,
"         document.getElementById('security-button')
"     );
" })();
" EOM

" 読み終わりましたわ
echo "vimp: ギギギ..."

" vim: set ft=vimperator:
